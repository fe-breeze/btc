var url="http://etc.apool.cc:83/miners",coin=GetQueryString("coin"),address=(coin="eth",GetQueryString("address")),datenow=(address="0x444814ed8d70a6fa5581a5fa2932e7984211e63e",new Date),nowSecond=3600*datenow.getHours()+60*datenow.getMinutes()+datenow.getSeconds(),now=Date.parse(new Date)/1e3;function GetBlockExplorerUrl(e){switch(e){case"eth":return"https://etherscan.io/tx/";case"etc":return"http://gastracker.io/tx/";case"zec":return"http://zcl.apool.cc/miner/"}return"todo"}function GetCoinSpeed(e,t){var a;return t=parseFloat(t),"etc"===e||"eth"===e?t<1?a=(1e3*t).toFixed(1)+" M/s":t>1&&(a=t.toFixed(3)+" G/s"):"zec"===e||"zcl"===e?a=t<10?(1e3*t).toFixed(1)+" Sol/s":t.toFixed(3)+" Ks/s":"sc"===e&&(a=t>999?(t/1e3).toFixed(1)+" G/s":(t/1e3).toFixed(0)+" M/s"),a}function GetQueryString(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(t);return null!==a?unescape(a[2]):null}function Average(e){if(0===e.length)return{avg:0,now:0};for(var t=0,a=0;a<e.length;a++)t+=e[a];return{avg:(t/e.length).toFixed(2),now:e[e.length-1].toFixed(2)}}$.getJSON(url,{coin:coin,miner:address},function(e){if(null===e.Result)return null;$(".ibox-title h5").text(address);var t=Average(e.Result.History.Speed);$("#minerSpeed").text(GetCoinSpeed(coin,t.now)+" / "+GetCoinSpeed(coin,t.avg));var a=e.Result.Balance;$("#minerBalance").text(a.Pay.toFixed(3)+" / "+a.Paid.toFixed(3)+" "+coin.toUpperCase());var n=a.Locked/nowSecond*24*3600;nowSecond<600&&(n=0),$("#minerLocked").text(a.Locked.toFixed(3)+" / "+n.toFixed(3)+" "+coin.toUpperCase());var o=0,r=0;$.each(e.Result.Miners,function(e,t){var a=$("<tr></tr>"),n=$("<td></td>");if(a.append(n.clone().text(e).attr("data-sort-value",e)),now-t.LastShare>518){var i=new Date;i.setTime(1e3*t.LastShare),a.append(n.clone().text(i.Format("MM-dd hh:mm:ss")).attr("data-sort-value",+i)),$("#minerDropTable").append(a),r++}else a.append(n.clone().text(GetCoinSpeed(coin,t.Speed)).attr("data-sort-value",t.Speed)),a.append('<td><a href="http://'+coin+".apool.cc/miner/"+address+"."+e+'">详情</a></td>'),$("#minerOnlineTable").append(a),o++}),$("#minerLen").text(o+" / "+r+" 台"),null!=e.Result.Paylog&&e.Result.Paylog.reverse(),$.each(e.Result.Paylog,function(e,t){var a=$("<tr></tr>"),n=$("<td></td>"),o=new Date;o.setTime(1e3*t.Time),a.append(n.clone().text(o.Format("MM-dd hh:mm:ss")).attr("data-sort-value",t.Time)),a.append(n.clone().text(t.Value.toFixed(4)));var r='<a target="view_window" href="'+GetBlockExplorerUrl(coin)+t.Hash+'">'+t.State+"</a>";a.append(n.append(r)),$("#minerPaylogTable").append(a)});var i=echarts.init(document.getElementById("main")),l=echarts.init(document.getElementById("main1")),s=e.Result.History,d=e.Result.Gains,c=[],p=[];(u={name:"总算力",type:"line"}).data=s.Speed,u.smooth=!0,u.itemStyle={normal:{lineStyle:{color:"#006633"}}},c.push(u),(u={name:"余额",type:"line",itemStyle:{normal:{lineStyle:{color:"#cc6600",width:1},areaStyle:{color:"#cccc66",type:"default"}}}}).data=s.Balance,u.yAxisIndex=1,u.smooth=!0,c.push(u);var u,m=[],x=[],h=[];$.each(d,function(e,t){m.push(new Date(1e3*t.Time).getFullYear()+"-"+new Date(1e3*t.Time).Format("MM-dd hh:mm:ss")),x.push(t.Diff),h.push(t.Price)}),console.log(x),(u={name:"价格",type:"line"}).data=h,u.smooth=!0,u.itemStyle={normal:{lineStyle:{color:"#006633"}}},p.push(u),(u={name:"难度",type:"line",itemStyle:{normal:{lineStyle:{color:"#cc6600",width:1},areaStyle:{color:"#cccc66",type:"default"}}}}).data=x,u.yAxisIndex=1,u.smooth=!0,p.push(u);var g={title:{text:"状态统计",left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#999"}}},grid:{bottom:60,right:0,left:40,top:60},legend:{data:["余额","总算力"],bottom:0},xAxis:[{type:"category",data:s.Time,axisPointer:{type:"shadow"}}],yAxis:[{type:"value",name:"余额",scale:!0,axisLabel:{formatter:"{value}"},splitNumber:8,min:function(e){var t=.5*e.min;return t<0&&(t=0),t.toFixed(1)},max:function(e){return(1.1*e.max).toFixed(1)}},{show:!1,type:"value",name:"总算力",axisLabel:{formatter:"{value}"},splitNumber:8,max:function(e){return 4*e.max}}],series:c},y={title:{text:"状态统计",left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#999"}}},grid:{bottom:60,right:0,left:40,top:60},legend:{data:["难度","价格"],bottom:0},xAxis:[{type:"category",data:m,axisPointer:{type:"shadow"}}],yAxis:[{type:"value",name:"难度",scale:!0,axisLabel:{formatter:"{value}"},splitNumber:8,min:function(e){var t=.5*e.min;return t<0&&(t=0),t.toFixed(1)},max:function(e){return(1.1*e.max).toFixed(1)}},{show:!1,type:"value",name:"价格",axisLabel:{formatter:"{value}"},splitNumber:8,max:function(e){return 4*e.max}}],series:p};i.setOption(g),l.setOption(y),$("#minerDropTable").tablesort(),$("#minerOnlineTable").tablesort(),$("#minerPaylogTable").tablesort()}),Date.prototype.Format=function(e){var t={"Y+":this.getFullYear(),"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var a in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+a+")").test(e)&&(e=e.replace(RegExp.$1,1===RegExp.$1.length?t[a]:("00"+t[a]).substr((""+t[a]).length)));return e};